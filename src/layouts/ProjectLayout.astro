---
import BaseLayout from "./BaseLayout.astro";
import Container from "../components/Container.astro";
import type { Project } from "../types";

interface Props {
  project: Project;
}

const { project } = Astro.props;

function formatDate(dateString: string): string {
  return new Date(dateString).toLocaleDateString("en-US", {
    year: "numeric",
    month: "short",
    day: "numeric",
  });
}

function formatStars(stars: number): string {
  if (stars >= 1000) {
    return `${(stars / 1000).toFixed(1)}k`;
  }
  return stars.toString();
}
---

<BaseLayout title={project.title} description={project.description}>
  <Container class="mt-24 sm:mt-32">
    <!-- Back link -->
    <a
      href="/"
      class="group mb-8 inline-flex items-center gap-2 text-sm text-neutral-500 transition-colors hover:text-neutral-700"
    >
      <svg
        class="h-4 w-4 transition-transform group-hover:-translate-x-0.5"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        stroke-width="1.5"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"></path>
      </svg>
      Back to projects
    </a>

    <!-- Header Card -->
    <header class="rounded-3xl bg-neutral-50 p-8 sm:p-12">
      <div class="flex flex-wrap items-start justify-between gap-4">
        <div class="flex-1">
          <div class="mb-3 flex items-center gap-3">
            {
              project.featured && (
                <span class="inline-flex items-center gap-1.5 rounded-full bg-neutral-950 px-3 py-1 text-xs font-semibold text-white">
                  <svg class="h-3 w-3" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                  </svg>
                  Featured
                </span>
              )
            }
            <span class="font-mono text-sm text-neutral-500"
              >{project.owner}/{project.repo}</span
            >
          </div>
          <h1
            class="font-display text-3xl font-semibold text-neutral-950 sm:text-4xl"
          >
            {project.title}
          </h1>
          {
            project.description && (
              <p class="mt-4 text-lg text-neutral-600">{project.description}</p>
            )
          }
        </div>
      </div>

      <!-- Meta info -->
      <div
        class="mt-8 flex flex-wrap items-center gap-4 border-t border-neutral-200 pt-6 text-sm text-neutral-500"
      >
        <span class="flex items-center gap-1.5">
          <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
            <path
              d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
            ></path>
          </svg>
          {formatStars(project.stars)} stars
        </span>
        <span class="flex items-center gap-1.5">
          <svg
            class="h-4 w-4"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="1.5"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          Updated {formatDate(project.updatedAt)}
        </span>
      </div>

      <!-- Tags -->
      {
        project.tags.length > 0 && (
          <div class="mt-6 flex flex-wrap gap-2">
            {project.tags.map((tag) => (
              <span class="tag">{tag}</span>
            ))}
          </div>
        )
      }

      <!-- Action buttons -->
      <div class="mt-8 flex flex-wrap gap-3">
        <a
          href={project.htmlUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="btn btn-primary"
        >
          <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 24 24">
            <path
              fill-rule="evenodd"
              d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"
              clip-rule="evenodd"></path>
          </svg>
          View on GitHub
        </a>
        {
          project.homepage && (
            <a
              href={project.homepage}
              target="_blank"
              rel="noopener noreferrer"
              class="btn btn-secondary"
            >
              <svg
                class="h-4 w-4"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="1.5"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"
                />
              </svg>
              Homepage
            </a>
          )
        }
      </div>
    </header>

    <!-- README content -->
    <article
      class="prose mx-auto mt-16 max-w-3xl prose-headings:scroll-mt-20 prose-headings:font-semibold prose-headings:text-neutral-950 prose-p:text-neutral-600 prose-a:text-neutral-950 prose-a:underline prose-a:decoration-neutral-300 prose-a:underline-offset-2 hover:prose-a:decoration-neutral-500 prose-blockquote:border-neutral-300 prose-blockquote:text-neutral-600 prose-strong:font-semibold prose-strong:text-neutral-950 prose-code:rounded-md prose-code:bg-neutral-100 prose-code:px-1.5 prose-code:py-0.5 prose-code:font-normal prose-code:text-neutral-800 prose-pre:rounded-xl prose-pre:border prose-pre:border-neutral-200 prose-pre:bg-neutral-50 prose-li:text-neutral-600 prose-li:marker:text-neutral-400 prose-th:font-semibold prose-th:text-neutral-950 prose-td:text-neutral-600 prose-img:rounded-xl prose-img:border prose-img:border-neutral-200 prose-hr:border-neutral-200"
    >
      <slot />
    </article>
  </Container>

  <!-- Spacer -->
  <div class="mt-24 sm:mt-32"></div>
</BaseLayout>
